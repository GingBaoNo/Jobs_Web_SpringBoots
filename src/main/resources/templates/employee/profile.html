<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${title} ?: 'Hồ sơ người xin việc'">Hồ sơ người xin việc</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-briefcase me-2"></i>Tìm Việc Làm
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/">Trang chủ</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/jobs">Việc làm</a>
                    </li>
                </ul>
                
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="/employee/profile" sec:authorize="hasRole('NV')">Hồ sơ của tôi</a>
                    </li>
                    <li class="nav-item dropdown" sec:authorize="isAuthenticated()">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown">
                            <span sec:authentication="name"></span>
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="/employee/profile">Hồ sơ cá nhân</a></li>
                            <li><a class="dropdown-item" href="/employee/applied-jobs">Việc đã ứng tuyển</a></li>
                            <li><a class="dropdown-item" href="/employee/saved-jobs">Việc đã lưu</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li>
                                <form th:action="@{/logout}" method="post" style="display: inline;">
                                    <button type="submit" class="dropdown-item">Đăng xuất</button>
                                </form>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container mt-4">
        <div class="row">
            <div class="col-md-12">
                <h2 th:text="${title}">Hồ sơ người xin việc</h2>
                <hr>
            </div>
        </div>
        
        <div class="row" id="profile-content">
            <div class="col-md-4">
                <div class="card mb-4">
                    <div class="card-body text-center">
                        <div class="profile-picture mb-3">
                            <i class="fas fa-user fa-5x text-primary" id="profile-avatar"></i>
                        </div>
                        <h5 class="card-title" id="profile-fullname">Đang tải...</h5>
                        <p class="text-muted" id="profile-position">Đang cập nhật...</p>
                        <div class="d-grid gap-2">
                            <a href="/employee/my-profile" class="btn btn-primary">Chỉnh sửa hồ sơ</a>
                            <button class="btn btn-outline-primary" id="download-cv-btn">Tải CV</button>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h6 class="mb-0"><i class="fas fa-info-circle me-2"></i>Thông tin nhanh</h6>
                    </div>
                    <div class="card-body">
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <span>Email</span>
                                <span class="text-muted" id="quick-email">Đang tải...</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <span>SĐT</span>
                                <span class="text-muted" id="quick-phone">Đang tải...</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <span>Ngày sinh</span>
                                <span class="text-muted" id="quick-birthdate">Đang tải...</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <span>Giới tính</span>
                                <span class="text-muted" id="quick-gender">Đang tải...</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <span>Kinh nghiệm</span>
                                <span class="text-muted" id="quick-experience">Đang tải...</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <span>Trình độ học vấn</span>
                                <span class="text-muted" id="quick-education">Đang tải...</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="col-md-8">
                <div class="card mb-4">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h6 class="mb-0">Thông tin cơ bản</h6>
                        <a href="/employee/my-profile" class="btn btn-sm btn-outline-primary">Chỉnh sửa</a>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <p><strong>Họ tên:</strong> <span id="basic-fullname">Đang tải...</span></p>
                                <p><strong>Ngày sinh:</strong> <span id="basic-birthdate">Đang tải...</span></p>
                                <p><strong>Giới tính:</strong> <span id="basic-gender">Đang tải...</span></p>
                                <p><strong>Số điện thoại:</strong> <span id="basic-phone">Đang tải...</span></p>
                            </div>
                            <div class="col-md-6">
                                <p><strong>Email:</strong> <span id="basic-email">Đang tải...</span></p>
                                <p><strong>Trình độ học vấn:</strong> <span id="basic-education">Đang tải...</span></p>
                                <p><strong>Tình trạng học vấn:</strong> <span id="basic-edu-status">Đang tải...</span></p>
                                <p><strong>CV:</strong> <span id="basic-cv">Đang tải...</span></p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card mb-4">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h6 class="mb-0">Mục tiêu nghề nghiệp</h6>
                        <a href="/employee/my-profile" class="btn btn-sm btn-outline-primary">Chỉnh sửa</a>
                    </div>
                    <div class="card-body">
                        <p id="profile-bio">Đang cập nhật...</p>
                    </div>
                </div>
                
                <div class="card mb-4">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h6 class="mb-0">Vị trí mong muốn</h6>
                        <a href="/employee/my-profile" class="btn btn-sm btn-outline-primary">Chỉnh sửa</a>
                    </div>
                    <div class="card-body">
                        <p id="desired-position">Đang cập nhật...</p>
                        <p><strong>Thời gian mong muốn:</strong> <span id="desired-time">Đang cập nhật...</span></p>
                        <p><strong>Loại thời gian làm việc:</strong> <span id="work-time-type">Đang cập nhật...</span></p>
                        <p><strong>Hình thức làm việc:</strong> <span id="work-form">Đang cập nhật...</span></p>
                        <p><strong>Loại lương mong muốn:</strong> <span id="salary-type">Đang cập nhật...</span></p>
                        <p><strong>Mức lương mong muốn:</strong> <span id="desired-salary">Đang cập nhật...</span></p>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h6 class="mb-0">Kinh nghiệm làm việc</h6>
                        <a href="/employee/my-profile" class="btn btn-sm btn-outline-primary">Chỉnh sửa</a>
                    </div>
                    <div class="card-body">
                        <div id="experience-content">
                            <p>Đang tải kinh nghiệm...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row d-none" id="no-profile-content">
            <div class="col-md-8 mx-auto text-center">
                <div class="card">
                    <div class="card-body py-5">
                        <i class="fas fa-user-slash fa-5x text-muted mb-3"></i>
                        <h4>Chưa có hồ sơ</h4>
                        <p class="text-muted">Bạn chưa tạo hồ sơ cá nhân. Hãy tạo hồ sơ để nhà tuyển dụng dễ dàng tìm thấy bạn.</p>
                        <a href="/employee/my-profile" class="btn btn-primary">Tạo hồ sơ ngay</a>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-dark text-light mt-5 py-4">
        <div class="container">
            <div class="text-center">
                <p>&copy; 2025 Hệ Thống Tìm Kiếm Việc Làm. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Hàm để tải thông tin hồ sơ
        async function loadProfile() {
            try {
                const response = await fetch('/api/v1/profiles/my-profile');
                const result = await response.json();
                
                if (result.success) {
                    const profile = result.data;
                    
                    // Cập nhật thông tin nhanh
                    document.getElementById('profile-fullname').textContent = profile.hoTen || 'Chưa cập nhật';
                    document.getElementById('profile-position').textContent = profile.viTriMongMuon || 'Chưa cập nhật';
                    document.getElementById('quick-email').textContent = 'Đang cập nhật...'; // Lấy từ thông tin user
                    document.getElementById('quick-phone').textContent = profile.soDienThoai || 'Chưa cập nhật';
                    document.getElementById('quick-birthdate').textContent = profile.ngaySinh ? new Date(profile.ngaySinh).toLocaleDateString('vi-VN') : 'Chưa cập nhật';
                    document.getElementById('quick-gender').textContent = profile.gioiTinh || 'Chưa cập nhật';
                    document.getElementById('quick-experience').textContent = profile.tongNamKinhNghiem ? profile.tongNamKinhNghiem + ' năm' : 'Chưa cập nhật';
                    document.getElementById('quick-education').textContent = profile.trinhDoHocVan || 'Chưa cập nhật';
                    
                    // Cập nhật thông tin cơ bản
                    document.getElementById('basic-fullname').textContent = profile.hoTen || 'Chưa cập nhật';
                    document.getElementById('basic-birthdate').textContent = profile.ngaySinh ? new Date(profile.ngaySinh).toLocaleDateString('vi-VN') : 'Chưa cập nhật';
                    document.getElementById('basic-gender').textContent = profile.gioiTinh || 'Chưa cập nhật';
                    document.getElementById('basic-phone').textContent = profile.soDienThoai || 'Chưa cập nhật';
                    document.getElementById('basic-email').textContent = 'Đang cập nhật...'; // Lấy từ thông tin user
                    document.getElementById('basic-education').textContent = profile.trinhDoHocVan || 'Chưa cập nhật';
                    document.getElementById('basic-edu-status').textContent = profile.tinhTrangHocVan || 'Chưa cập nhật';
                    document.getElementById('basic-cv').textContent = profile.urlCv || 'Chưa cập nhật';
                    
                    // Cập nhật mục tiêu nghề nghiệp
                    document.getElementById('profile-bio').textContent = profile.gioiThieuBanThan || 'Chưa cập nhật';
                    
                    // Cập nhật vị trí mong muốn
                    document.getElementById('desired-position').textContent = profile.viTriMongMuon || 'Chưa cập nhật';
                    document.getElementById('desired-time').textContent = profile.thoiGianMongMuon || 'Chưa cập nhật';
                    document.getElementById('work-time-type').textContent = profile.loaiThoiGianLamViec || 'Chưa cập nhật';
                    document.getElementById('work-form').textContent = profile.hinhThucLamViec || 'Chưa cập nhật';
                    document.getElementById('salary-type').textContent = profile.loaiLuongMongMuon || 'Chưa cập nhật';
                    document.getElementById('desired-salary').textContent = profile.mucLuongMongMuon ? profile.mucLuongMongMuon.toLocaleString('vi-VN') + ' VNĐ' : 'Chưa cập nhật';
                    
                    // Cập nhật kinh nghiệm làm việc
                    document.getElementById('experience-content').innerHTML = 
                        '<p>' + (profile.kinhNghiem || 'Chưa có kinh nghiệm được cập nhật') + '</p>';
                    
                    // Ẩn phần chưa có hồ sơ và hiện nội dung hồ sơ
                    document.getElementById('profile-content').classList.remove('d-none');
                    document.getElementById('no-profile-content').classList.add('d-none');
                } else {
                    // Không tìm thấy hồ sơ, hiện phần thông báo chưa có hồ sơ
                    document.getElementById('profile-content').classList.add('d-none');
                    document.getElementById('no-profile-content').classList.remove('d-none');
                }
            } catch (error) {
                console.error('Lỗi khi tải hồ sơ:', error);
                alert('Lỗi khi tải thông tin hồ sơ');
            }
        }
        
        // Gọi hàm khi trang được tải
        document.addEventListener('DOMContentLoaded', function() {
            loadProfile();
        });
    </script>
</body>
</html>